-- /////////////////////////////////////////////////////////////
-- //                 UI LIBRARY SOURCE CODE                  //
-- /////////////////////////////////////////////////////////////

local Library = {}
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- [1] Rainbow Text Logic
local function ApplyRainbow(TextLabel)
	task.spawn(function()
		while true do
			local hue = tick() % 5 / 5 
			local color = Color3.fromHSV(hue, 1, 1) 
			TextLabel.TextColor3 = color
			RunService.Heartbeat:Wait()
		end
	end)
end

-- [2] Dragging Logic
local function MakeDraggable(Frame)
	local dragging, dragInput, dragStart, startPos
	Frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = Frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	Frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
	end)
	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

function Library:Create(Config)
	-- Variables
	local TitleText = Config.Title or "UI Library"
	local CreatorText = Config.Creator or "Unknown"
	
	-- GUI Creation
	local Gui = Instance.new("ScreenGui")
	Gui.Name = "CleanLibrary_"..math.random(1,1000)
	Gui.ResetOnSpawn = false
	Gui.Parent = Player:WaitForChild("PlayerGui")

	local Main = Instance.new("Frame", Gui)
	Main.Size = UDim2.new(0, 220, 0, 0)
	Main.Position = UDim2.new(0.5, -110, 0.4, 0)
	Main.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)
	MakeDraggable(Main)

	-- Header
	local TitleLabel = Instance.new("TextLabel", Main)
	TitleLabel.Size = UDim2.new(1, -10, 0, 30)
	TitleLabel.Position = UDim2.new(0, 10, 0, 0)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = TitleText
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 14
	TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

	-- Rainbow Creator Name
	local CreatorLabel = Instance.new("TextLabel", Main)
	CreatorLabel.Size = UDim2.new(1, -10, 0, 15)
	CreatorLabel.Position = UDim2.new(0, 0, 0, 25)
	CreatorLabel.BackgroundTransparency = 1
	CreatorLabel.Text = "Created by " .. CreatorText
	CreatorLabel.Font = Enum.Font.Gotham
	CreatorLabel.TextSize = 10
	CreatorLabel.TextXAlignment = Enum.TextXAlignment.Right
	ApplyRainbow(CreatorLabel)

	-- Container
	local Container = Instance.new("Frame", Main)
	Container.Position = UDim2.new(0, 0, 0, 45)
	Container.Size = UDim2.new(1, 0, 0, 0)
	Container.BackgroundTransparency = 1

	local UIList = Instance.new("UIListLayout", Container)
	UIList.SortOrder = Enum.SortOrder.LayoutOrder
	UIList.Padding = UDim.new(0, 5)
	UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center

	-- Resize Logic
	local function UpdateSize()
		local ContentHeight = UIList.AbsoluteContentSize.Y
		Main.Size = UDim2.new(0, 220, 0, 55 + ContentHeight)
	end
	UIList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(UpdateSize)

	-- Return Object
	local Window = {}
	
	function Window:AddButton(text, callback)
		local Btn = Instance.new("TextButton", Container)
		Btn.Size = UDim2.new(0.9, 0, 0, 30)
		Btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
		Btn.Text = text
		Btn.Font = Enum.Font.Gotham
		Btn.TextColor3 = Color3.fromRGB(220, 220, 220)
		Btn.TextSize = 12
		Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
		
		Btn.MouseButton1Click:Connect(function()
			pcall(callback)
		end)
		UpdateSize()
	end
	
	UpdateSize()
	return Window
end
